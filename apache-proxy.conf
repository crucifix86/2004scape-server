# Apache configuration for 2004scape server proxy
# This file needs to be copied to /etc/apache2/sites-available/2004scape.conf
# and enabled with: sudo a2ensite 2004scape

<VirtualHost *:80>
    ServerName localhost
    ServerAlias 2004scape.local
    
    # Enable proxy modules
    ProxyRequests Off
    ProxyPreserveHost On
    
    # Proxy all requests to the Node.js server on port 8888
    ProxyPass / http://localhost:8888/
    ProxyPassReverse / http://localhost:8888/
    
    # WebSocket support for the game
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "ws://localhost:8888/$1" [P,L]
    
    # Additional headers for proper proxying
    <Location />
        Header set X-Forwarded-Proto "http"
        Header set X-Forwarded-Host $host
        Header set X-Forwarded-For $proxy_add_x_forwarded_for
    </Location>
    
    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/2004scape-error.log
    CustomLog ${APACHE_LOG_DIR}/2004scape-access.log combined
</VirtualHost>